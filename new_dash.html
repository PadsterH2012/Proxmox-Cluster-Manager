<!DOCTYPE html>
<html>
<head>
<style>
  body {
    font-family: 'Roboto', sans-serif;
    background: #1a1a1a;
    color: #ffffff;
    margin: 0;
    padding: 0;
  }

  .nav-bar {
    background: #2d2d2d;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .logo {
    color: #4a90e2;
    font-size: 24px;
  }

  .nav-links {
    display: flex;
    gap: 20px;
  }

  .nav-links a {
    color: #4a90e2;
    text-decoration: none;
  }

  .nav-links a:hover {
    color: #357abd;
  }

  .dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
  }

  .dashboard-title {
    color: #ffffff;
    font-size: 24px;
    margin: 0;
  }

  .connection-status {
    color: #4CAF50;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .connection-status::before {
    content: '';
    display: inline-block;
    width: 8px;
    height: 8px;
    background: #4CAF50;
    border-radius: 50%;
  }

  .metrics-bar {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    padding: 0 20px;
    margin-bottom: 20px;
  }

  .metric-card {
    background: #2d2d2d;
    border-radius: 10px;
    padding: 20px;
  }

  .metric-title {
    color: #888;
    margin-bottom: 10px;
  }

  .metric-value {
    font-size: 24px;
    color: #4a90e2;
    margin-bottom: 5px;
  }

  .metric-ratio {
    color: #888;
    font-size: 14px;
  }

  .progress-bar {
    width: 100%;
    height: 4px;
    background: #1a1a1a;
    border-radius: 2px;
    margin-top: 10px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: #4a90e2;
    transition: width 0.3s ease;
  }

  .dashboard-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    padding: 20px;
  }

  .panel {
    background: #2d2d2d;
    border-radius: 10px;
    padding: 20px;
  }

  .panel-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .panel-title {
    color: #ffffff;
    font-size: 20px;
    margin: 0;
  }

  .btn {
    background: #4a90e2;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    transition: background 0.2s;
  }

  .btn:hover {
    background: #357abd;
  }

  .log-filters {
    display: flex;
    gap: 15px;
    margin-top: 15px;
  }

  .log-filters label {
    display: flex;
    align-items: center;
    gap: 5px;
    color: #888;
  }

  .log-content {
    background: #1a1a1a;
    border-radius: 4px;
    padding: 15px;
    margin-top: 15px;
    height: 200px;
    overflow-y: auto;
  }

  .settings-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    padding: 20px;
  }

  .settings-panel {
    background: #2d2d2d;
    border-radius: 10px;
    padding: 20px;
  }

  .settings-title {
    color: #ffffff;
    font-size: 20px;
    margin: 0 0 20px 0;
  }

  .form-group {
    margin-bottom: 15px;
  }

  .form-group label {
    display: block;
    color: #888;
    margin-bottom: 5px;
  }

  .form-group input[type="text"],
  .form-group input[type="number"],
  .form-group input[type="password"] {
    width: 100%;
    padding: 8px;
    background: #1a1a1a;
    border: 1px solid #3d3d3d;
    border-radius: 4px;
    color: #fff;
    box-sizing: border-box;
  }

  .error-message {
    color: #ff5252;
    font-size: 14px;
    margin-top: 10px;
    display: none;
  }

  .success-message {
    color: #4CAF50;
    font-size: 14px;
    margin-top: 10px;
    display: none;
  }

  .form-error input {
    border-color: #ff5252;
  }

  ::-webkit-scrollbar {
    width: 8px;
  }

  ::-webkit-scrollbar-track {
    background: #1a1a1a;
  }

  ::-webkit-scrollbar-thumb {
    background: #4a90e2;
    border-radius: 4px;
  }
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Connection Settings Form
    const connectionForm = document.getElementById('connection-form');
    connectionForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const errorMsg = document.getElementById('connection-error');
        const successMsg = document.getElementById('connection-success');
        
        // Reset messages
        errorMsg.style.display = 'none';
        successMsg.style.display = 'none';
        
        // Get form data
        const formData = {
            host: document.getElementById('proxmox-host').value,
            port: document.getElementById('proxmox-port').value,
            password: document.getElementById('proxmox-password').value,
            verifySSL: document.getElementById('verify-ssl').checked
        };

        try {
            const response = await fetch('/api/settings/proxmox', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.cookie.split('csrf_token=')[1].split(';')[0]
                },
                body: JSON.stringify({
                    hostname: formData.host,
                    port: formData.port,
                    password: formData.password,
                    verify_ssl: formData.verifySSL,
                    username: 'root@pam' // Default Proxmox username
                })
            });

            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.error || 'Failed to save connection settings');
            }

            if (data.warning) {
                errorMsg.style.display = 'block';
                errorMsg.textContent = data.warning;
                return;
            }

            successMsg.style.display = 'block';
            successMsg.textContent = 'Connection settings saved successfully';
        } catch (error) {
            errorMsg.style.display = 'block';
            errorMsg.textContent = error.message;
        }
    });

    // Maintenance Settings Form
    const maintenanceForm = document.getElementById('maintenance-form');
    maintenanceForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const errorMsg = document.getElementById('maintenance-error');
        const successMsg = document.getElementById('maintenance-success');
        
        errorMsg.style.display = 'none';
        successMsg.style.display = 'none';
        
        const formData = {
            updateInterval: document.getElementById('update-interval').value,
            metricsInterval: document.getElementById('metrics-interval').value,
            autoMigration: document.getElementById('auto-migration').checked
        };

        try {
            const response = await fetch('/settings/update', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.cookie.split('csrf_token=')[1].split(';')[0]
                },
                body: JSON.stringify({
                    maintenance_window: '',  // Not in UI yet
                    auto_migrate: formData.autoMigration,
                    rolling_update: true,  // Default to true
                    update_retry: true  // Default to true
                })
            });

            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.message || 'Failed to save maintenance settings');
            }

            successMsg.style.display = 'block';
            successMsg.textContent = 'Maintenance settings saved successfully';
        } catch (error) {
            errorMsg.style.display = 'block';
            errorMsg.textContent = error.message;
        }
    });

    // Notification Settings Form
    const notificationForm = document.getElementById('notification-form');
    notificationForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const errorMsg = document.getElementById('notification-error');
        const successMsg = document.getElementById('notification-success');
        
        errorMsg.style.display = 'none';
        successMsg.style.display = 'none';
        
        const formData = {
            emailEnabled: document.getElementById('email-notifications').checked
        };

        try {
            const response = await fetch('/settings/balance', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.cookie.split('csrf_token=')[1].split(';')[0]
                },
                body: JSON.stringify({
                    balance_mode: 'auto',  // Default to auto
                    load_threshold: 80,  // Default threshold
                    min_load_diff: 20,  // Default difference
                    check_interval: formData.metricsInterval,
                    max_concurrent: 2  // Default to 2
                })
            });

            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.message || 'Failed to save notification settings');
            }

            successMsg.style.display = 'block';
            successMsg.textContent = 'Notification settings saved successfully';
        } catch (error) {
            errorMsg.style.display = 'block';
            errorMsg.textContent = error.message;
        }
    });
});
</script>
</head>
<body>
  <nav class="nav-bar">
    <div class="logo">üñ•Ô∏è</div>
    <div class="nav-links">
      <a href="#">Dashboard</a>
      <a href="#">Settings</a>
      <a href="#">Logout</a>
    </div>
  </nav>

  <div class="dashboard-header">
    <h1 class="dashboard-title">Cluster Dashboard</h1>
    <div class="connection-status">Connected - Password Auth</div>
  </div>

  <div class="metrics-bar">
    <div class="metric-card">
      <div class="metric-title">VMs</div>
      <div class="metric-value">9</div>
      <div class="metric-ratio">/9</div>
    </div>
    <div class="metric-card">
      <div class="metric-title">LXC</div>
      <div class="metric-value">14</div>
      <div class="metric-ratio">/12</div>
    </div>
    <div class="metric-card">
      <div class="metric-title">Cluster CPU</div>
      <div class="metric-value">8%</div>
      <div class="progress-bar">
        <div class="progress-fill" style="width: 8%"></div>
      </div>
      <div class="metric-ratio">24 Cores Total</div>
    </div>
    <div class="metric-card">
      <div class="metric-title">Cluster Memory</div>
      <div class="metric-value">59%</div>
      <div class="progress-bar">
        <div class="progress-fill" style="width: 59%"></div>
      </div>
      <div class="metric-ratio">53.40GiB out of 90.53GiB</div>
    </div>
  </div>

  <div class="dashboard-grid">
    <div class="panel">
      <div class="panel-header">
        <h2 class="panel-title">Cluster Metrics</h2>
        <button class="btn">Collect Metrics</button>
      </div>
      <div class="log-filters">
        <label><input type="checkbox" checked> Info</label>
        <label><input type="checkbox" checked> Warning</label>
        <label><input type="checkbox" checked> Critical</label>
      </div>
      <div class="log-content"></div>
    </div>

    <div class="panel">
      <div class="panel-header">
        <h2 class="panel-title">Updates</h2>
        <button class="btn">Check Updates</button>
      </div>
      <div class="log-filters">
        <label><input type="checkbox" checked> Info</label>
        <label><input type="checkbox" checked> Warning</label>
        <label><input type="checkbox" checked> Critical</label>
      </div>
      <div class="log-content"></div>
    </div>

    <div class="panel">
      <div class="panel-header">
        <h2 class="panel-title">Migration Status</h2>
      </div>
      <div class="log-filters">
        <label><input type="checkbox" checked> Info</label>
        <label><input type="checkbox" checked> Warning</label>
        <label><input type="checkbox" checked> Critical</label>
      </div>
      <div class="log-content"></div>
    </div>

    <div class="panel">
      <div class="panel-header">
        <h2 class="panel-title">Resource Allocation</h2>
      </div>
      <div class="log-filters">
        <label><input type="checkbox" checked> Info</label>
        <label><input type="checkbox" checked> Warning</label>
        <label><input type="checkbox" checked> Critical</label>
      </div>
      <div class="log-content"></div>
    </div>
  </div>

  <div class="settings-grid">
    <div class="settings-panel">
      <h2 class="settings-title">Proxmox Connection</h2>
      <form id="connection-form">
        <div class="form-group">
          <label for="proxmox-host">Proxmox Host:</label>
          <input type="text" id="proxmox-host" placeholder="Enter host address" required>
        </div>
        <div class="form-group">
          <label for="proxmox-port">Port:</label>
          <input type="number" id="proxmox-port" value="8006" required>
        </div>
        <div class="form-group">
          <label for="proxmox-password">Password:</label>
          <input type="password" id="proxmox-password" required>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="verify-ssl" checked> 
            Verify SSL Certificate
          </label>
        </div>
        <button type="submit" class="btn">Save Connection Settings</button>
        <div id="connection-error" class="error-message"></div>
        <div id="connection-success" class="success-message"></div>
      </form>
    </div>

    <div class="settings-panel">
      <h2 class="settings-title">Maintenance Settings</h2>
      <form id="maintenance-form">
        <div class="form-group">
          <label for="update-interval">Update Check Interval (hours):</label>
          <input type="number" id="update-interval" value="24" required>
        </div>
        <div class="form-group">
          <label for="metrics-interval">Metrics Collection Interval (minutes):</label>
          <input type="number" id="metrics-interval" value="15" required>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="auto-migration"> 
            Enable Automatic VM Migration
          </label>
        </div>
        <button type="submit" class="btn">Save Maintenance Settings</button>
        <div id="maintenance-error" class="error-message"></div>
        <div id="maintenance-success" class="success-message"></div>
      </form>
    </div>

    <div class="settings-panel">
      <h2 class="settings-title">Notification Settings</h2>
      <form id="notification-form">
        <div class="form-group">
          <label>
            <input type="checkbox" id="email-notifications"> 
            Enable Email Notifications
          </label>
        </div>
        <button type="submit" class="btn">Save Notification Settings</button>
        <div id="notification-error" class="error-message"></div>
        <div id="notification-success" class="success-message"></div>
      </form>
    </div>
  </div>
</body>
</html>
